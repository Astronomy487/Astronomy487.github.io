<!DOCTYPE html>
<html>
<head>
  <title>Sokoban</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;800&display=swap');
    * {font-family: Work Sans;}
    ::selection{color:#F0F0F0;background:#FF2E63;}::-moz-selection{color:#F0F0F0;background:#FF2E63;}
    .title {width: 300px; top: 0px; left: 0px; padding: 32px; user-select: text; color: #303841; font-size: 18px;}
    h1 {font-weight: bold; font-size: 24px; margin-top: 12px;}
    a {color: inherit; text-decoration: underline;}
    .emoji {height: 32px; transition: 0.3s; border-radius: 2px;} .emoji:hover {transform: scale(3);}
    
    body {background-color: #F0F0F0; user-select: none;}
    #boardbody {position: absolute; left: 50%; top: 50%; transform: translate(-50%,-50%); background-color: #303841; border-collapse: collapse;}
    
    .e {background-color: inherit;}
    .p {background-color: #FF2E63;}
    .w {background-color: #F0F0F0;}
    .b {background-color: #FBD316;}
    .g {box-shadow: inset 0px 0px 0px 3px #F0F0F080;}
    .b.g {background-color: #eb9c34;}
  </style>
  <style id="sizestyle">
  </style>
</head>
<body id="body">
  <div class="title">
    <h1>Sokoban</h1>
    <h4 id="progress"></h2>
    <p>a version of sokoban i am making that runs on the web using js :D i'm trying to learn more about using js in 2021</p>
    <p>still in development !!! things i want to do with it:</p>
    <ul>
      <li>load levels with an image</li>
      <li>load a series of levels</li>
      <li>make a progress bar</li>
      <li>make something happen when you win</li>
      <li>possibly create pixel art sprites instead of just color blocks</li>
      <li>create more tiles with more advanced behaviors ! doors....keys....buttons...who knows!! i think it would be fun to put a creative twist on sokoban</li>
      <li>multiple player pieces <img src="https://data.whicdn.com/images/342105838/original.jpg" class="emoji"></li>
    </ul>
    <p><a href="../../">go back to my home page</a></p>
  </div>
  <script>
    /*let board = [
      ["e","e","e","e","e","e","e","e","e","e","e","e","e","e","e","e"],
      ["e","e","e","e","e","e","e","e","e","e","e","e","e","e","e","e"],
      ["e","e","e","e","e","e","e","e","e","e","e","e","e","e","e","e"],
      ["e","e","e","e","e","e","e","e","e","e","e","e","e","e","e","e"],
      ["e","e","e","e","e","e","e","e","e","e","e","b","b","e","e","e"],
      ["e","w","e","w","e","w","e","e","e","e","e","e","e","e","e","e"],
      ["e","w","e","w","e","w","e","e","e","e","e","e","e","e","e","e"],
      ["e","w","e","w","e","w","e","e","e","e","e","e","e","e","e","e"],
      ["e","w","e","w","e","w","e","e","e","e","e","e","e","e","e","e"],
      ["e","w","e","w","e","w","e","e","e","e","e","e","e","e","e","e"],
      ["e","w","e","w","e","w","e","e","e","e","e","e","e","e","e","e"],
      ["e","w","e","w","e","w","e","e","e","e","e","e","e","e","e","e"],
      ["e","e","e","e","e","e","e","e","e","e","e","e","e","e","e","e"],
      ["e","e","e","e","e","e","e","e","e","e","e","e","e","e","e","e"],
      ["e","e","e","e","e","e","e","e","e","e","e","e","e","e","e","e"],
      ["e","e","e","e","e","e","e","e","e","e","e","e","e","e","e","e"]
    ];*/
    let board = [
      ["w","w","e","e","e","w","w"],
      ["e","e","b","e","e","w","w"],
      ["w","w","e","b","e","w","w"],
      ["e","w","w","b","e","w","w"],
      ["e","w","e","e","e","w","w"],
      ["b","e","b","b","b","e","w"],
      ["e","e","e","e","e","e","w"]
    ];
    let boardsize = 7;
    let playX = 1;
    let playY = 1;
    board[playX][playY] = "p";
    
    let goal = [
      [1,0],
      [3,0],
      [2,4],
      [4,3],
      [6,3],
      [5,5],
      [5,2]
    ]
    
    let cellsize = Math.round(80/boardsize)*8
    document.getElementById("sizestyle").innerHTML = "td {width: "+cellsize+"px; height: "+cellsize+"px;}";
    
    //every frame
    let x = setInterval(function() {
    
      //generate cells with classes
      let bodyText = ""
      for (let xIndex = 0; xIndex < boardsize; xIndex++) {
        bodyText += "<tr>";
        for (let yIndex = 0; yIndex < boardsize; yIndex++) {
          bodyText += '<td class="'+board[xIndex][yIndex]+'" id="c'+xIndex+yIndex+'"></td>';
        }
        bodyText += "</tr>";
      }
      document.getElementById("boardbody").innerHTML = bodyText;
      
      //goals
      let completed = 0;
      for (let arrayIndex = 0; arrayIndex < goal.length; arrayIndex++) {
        //set goal class to cells
        document.getElementById("c"+goal[arrayIndex][0]+goal[arrayIndex][1]).setAttribute("class",board[goal[arrayIndex][0]][goal[arrayIndex][1]]+" g")
        //check for win
        if (board[goal[arrayIndex][0]][goal[arrayIndex][1]] == "b") {
          completed++;
        }
      }
      document.getElementById("progress").innerHTML = completed+" out of "+goal.length+" boxes in";
      if (completed == goal.length) {
        document.getElementById("progress").innerHTML += "<br>you win!!!";
        document.getElementById("body").setAttribute("style","background-image: url('https://media2.giphy.com/media/lPoOHG39XAlV4it61H/source.gif'); background-size: cover; background-repeat: no-repeat;");
      }
      
    }, 10);
    
    //inputs
    document.onkeydown = function(e) {
      //set target coords
      let targetX = playX
      let targetY = playY 
      switch (e.keyCode) {
        case 37: case 65:
          targetY--;
          break; 
        case 38: case 87:
          targetX--;
          break;
        case 39: case 68:
          targetY++;
          break;
        case 40: case 83:
          targetX++;
          break
      }
      
      tryToMove:
      if ((0 <= targetX && targetX <= boardsize-1 && 0 <= targetY && targetY <= boardsize-1) && board[targetX][targetY] != "w") {
        //target is not wall
        
        //is target a box?
        if (board[targetX][targetY] == "b") {
          //pushing a box
          
          //pushing box out of boundary? if so stop
          if (!(0 <= targetX*2-playX && targetX*2-playX <= boardsize-1 && 0 <= targetY*2-playY && targetY*2-playY <= boardsize-1)) {
            break tryToMove;
          }
          
          let boxInto = board[targetX*2-playX][targetY*2-playY]; //what the box is pushing into
          if (boxInto == "e") { //pushing into empty space
            board[targetX*2-playX][targetY*2-playY] = "b";
          } else if (boxInto == "w") { //pushing into wall
            break tryToMove;
          } else if (boxInto == "b") { //pushing into another box
            break tryToMove;
          }
        }
        
        //move to new space and leave empty behind
        board[playX][playY] = "e";
        playX = targetX;
        playY = targetY;
        board[playX][playY] = "p";
      }
    }
  </script>
  <table>
    <tbody id="boardbody"></tbody>
  </table>
</body>
</html>