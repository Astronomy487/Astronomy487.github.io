<!DOCTYPE html>
<html>
<head>
  <link rel="icon" href="icon.png">
  <title>Complex</title>
  <style>
    body {
      background-color: white;
    }
    
    canvas {
      background-color: white;
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%,-50%);
      border-radius: 0.5rem;
    }
  </style>
</head>
<body>
  <canvas id="myCanvas" width="0" height="0"></canvas>
  <script>
    let pi = Math.PI;
    let complex = {
      add: function(a, b) {
        return [a[0]+b[0],a[1]+b[1]];
      },
      mult: function(a, b) {
        return [a[0]*b[0]-a[1]*b[1],a[1]*b[0]+a[0]*b[1]];
      },
      r: function(a) {
        return Math.sqrt(a[0]*a[0]+a[1]*a[1]);
      },
      theta: function(a) {
        if (a[0] == 0) {
          if (a[1] > 0) return pi/2;
          if (a[1] < 0) return 3*pi/2;
          return 0;
        } else {
          return Math.atan(a[1]/a[0]);
        }
      },
      polar: function(r,theta) {
        return [r*Math.cos(theta),r*Math.sin(theta)];
      },
      power: function(a,k) {
        return complex.polar(Math.pow(complex.r(a),k),k*complex.theta(a));
      }
    };
    function escape(z,c,maxIterations) {
      let i = 0;
      while (i < maxIterations) {
        z = s.iterate(z,c);
        if (complex.r(z) > 2) return i;
        i++;
      }
      return null;
    }
  </script>
  <script>
    let preset = {};
    preset["Burning Ship"]={minX:-1.8,maxX:-1.7,minY:-.08,maxY:.02,divX:1440,divY:1440,visX:720,visY:720,palette:["ff0000","ff2a00","ff5500","ff8000","ffaa00","ffd500","ffff00","d4ff00","aaff00","80ff00","55ff00","2bff00","00ff00","00ff2a","00ff55","00ff80","00ffaa","00ffd5","00ffff","00d5ff","00aaff","0080ff","0055ff","002aff","0000ff","2b00ff","5500ff","8000ff","aa00ff","d400ff","ff00ff","ff00d4","ff00aa","ff0080","ff0055","ff002b"],setColor:"FFFFFF",z:function(f,a){return[0,0]},c:function(f,a){return[f,a]},iterate:function(f,a){return f[0]=Math.abs(f[0]),f[1]=Math.abs(f[1]),complex.add(complex.mult(f,f),a)},depth:50};
    let s = {
      minX: -1.5, //bounds in number space
      maxX: 1.5,
      minY: -1.5,
      maxY: 1.5,
      divX: 720, //how many pixels
      divY: 720,
      visX: 720, //canvas size
      visY: 720,
      palette: ["ff0000","ff2a00","ff5500","ff8000","ffaa00","ffd500","ffff00","d4ff00","aaff00","80ff00","55ff00","2bff00","00ff00","00ff2a","00ff55","00ff80","00ffaa","00ffd5","00ffff","00d5ff","00aaff","0080ff","0055ff","002aff","0000ff","2b00ff","5500ff","8000ff","aa00ff","d400ff","ff00ff","ff00d4","ff00aa","ff0080","ff0055","ff002b"], //colors
      setColor: "FFFFFF", //fill color
      z: function(i,j) {return [i,j];}, //how z is determined
      c: function(i,j) {return [0.35,0.355];}, //how c is determined
      iterate: function(z,c) {return complex.add(complex.mult(z,z),c);},
      depth: 1000 //max iterations
    };
    //s = preset["Burning Ship"];
    
    s.stepX = (s.maxX-s.minX)/s.divX;
    s.stepY = (s.maxY-s.minY)/s.divY;
    
    let canvas = document.getElementById("myCanvas");
    let context = canvas.getContext("2d");
    draw();
    function draw() {
      canvas.setAttribute("width",s.visX);
      canvas.setAttribute("height",s.visY);
      for (i = s.minX; i < s.maxX; i += s.stepX) {
        for (j = s.minY; j < s.maxY; j += s.stepY) {
        
          let z = s.z(i,j);
          let c = s.c(i,j);
          let iterations = escape(z,c,s.depth);
          
          let color = s.setColor;
          if (iterations == null) {
            //non escaped
          } else {
            //escaped
            iterations %= s.palette.length;
            color = s.palette[iterations];
          }
          pixel([i,j],color);
        }
      }
    }
    function pixel(a,color) {
      let x = a[0];
      let y = a[1];
      let coordX = s.visX*(x-s.minX)/(s.maxX-s.minX);
      let coordY = s.visY*(y-s.minY)/(s.maxY-s.minY);
      context.fillStyle = "#"+color;
      context.fillRect(coordX, coordY, s.stepX*s.visX/(s.maxX-s.minX), s.stepY*s.visY/(s.maxY-s.minY));
    }
  </script>
</body>
</html>