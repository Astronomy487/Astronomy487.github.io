<!DOCTYPE html>
<html>
<head>
  <title>Chess</title>
  <link rel="icon" href="icon.png">
  <style>
    html {
      font-size: 24px;
    }
    
    body {
      background-color: var(--white);
      color: var(--black);
      user-select: none;
      overflow: none;
      margin: 0;
    }
    
    #board {
      border-collapse: collapse;
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%,-50%);
    }
    
    #board td {
      width: 4rem;
      height: 4rem;
      font-size: 3rem;
      line-height: 4rem;
      text-align: center;
      transition: 0.2s;
    }
  </style>
  <link rel="stylesheet" id="design-link" href="modern/style.css">
</head>
<body>
  <button onclick="setStyle('modern')">Modern</button>
  <button onclick="setStyle('drawn')">Drawn</button>
  <table id="board"></table>
  <script>
    let piece = {
      king: {
        textChar: "l",
        textCode: "&#x265A;",
        leaper: [
          {xGo: 1, yGo: 1},
          {xGo: 1, yGo: 0},
          {xGo: 1, yGo: -1},
          {xGo: 0, yGo: 1},
          {xGo: 0, yGo: 0},
          {xGo: 0, yGo: -1},
          {xGo: -1, yGo: 1},
          {xGo: -1, yGo: 0},
          {xGo: -1, yGo: -1}
        ],
        moveLikePawn: false
      },
      queen: {
        textChar: "w",
        textCode: "&#x265B;",
        rider: [
          {xGo: 1, yGo: 0},
          {xGo: -1, yGo: 0},
          {xGo: 0, yGo: 1},
          {xGo: 0, yGo: -1},
          {xGo: 1, yGo: 1},
          {xGo: -1, yGo: 1},
          {xGo: 1, yGo: -1},
          {xGo: -1, yGo: -1}
        ],
        moveLikePawn: false
      },
      rook: {
        textChar: "t",
        textCode: "&#x265C;",
        rider: [
          {xGo: 1, yGo: 0},
          {xGo: -1, yGo: 0},
          {xGo: 0, yGo: 1},
          {xGo: 0, yGo: -1}
        ],
        moveLikePawn: false
      },
      bishop: {
        textChar: "v",
        textCode: "&#x265D;",
        rider: [
          {xGo: 1, yGo: 1},
          {xGo: -1, yGo: 1},
          {xGo: 1, yGo: -1},
          {xGo: -1, yGo: -1}
        ],
        moveLikePawn: false
      },
      knight: {
        textChar: "m",
        textCode: "&#x265E;",
        leaper: [
          {xGo: 2, yGo: 1},
          {xGo: 2, yGo: -1},
          {xGo: -2, yGo: 1},
          {xGo: -2, yGo: -1},
          {xGo: 1, yGo: 2},
          {xGo: 1, yGo: -2},
          {xGo: -1, yGo: 2},
          {xGo: -1, yGo: -2}
        ],
        moveLikePawn: false
      },
      pawn: {
        textChar: "o",
        textCode: "&#x265F;",
        moveLikePawn: true
      }
    }
    let boardWidth = 8;
    let boardHeight = 8;
    
    let textRef;
    function setStyle(style) {
      textRef = {modern: "textChar", drawn: "textCode"}[style];
      makeBoard();
      element("design-link").setAttribute("href",style+"/style.css");
    }
    
    function element(id) {
      return document.getElementById(id);
    }
    
    let board = [
      [{piece:"rook",color:"black"},{piece:"knight",color:"black"},{piece:"bishop",color:"black"},{piece:"queen",color:"black"},{piece:"king",color:"black"},{piece:"bishop",color:"black"},{piece:"knight",color:"black"},{piece:"rook",color:"black"}],
      [{piece:"pawn",color:"black"},{piece:"pawn",color:"black"},{piece:"pawn",color:"black"},{piece:"pawn",color:"black"},{piece:"pawn",color:"black"},{piece:"pawn",color:"black"},{piece:"pawn",color:"black"},{piece:"pawn",color:"black"}],
      [null,null,null,null,null,null,null,null],
      [null,null,null,null,null,null,null,null],
      [null,null,null,null,null,null,null,null],
      [null,null,null,null,null,null,null,null],
      [{piece:"pawn",color:"white"},{piece:"pawn",color:"white"},{piece:"pawn",color:"white"},{piece:"pawn",color:"white"},{piece:"pawn",color:"white"},{piece:"pawn",color:"white"},{piece:"pawn",color:"white"},{piece:"pawn",color:"white"}],
      [{piece:"rook",color:"white"},{piece:"knight",color:"white"},{piece:"bishop",color:"white"},{piece:"queen",color:"white"},{piece:"king",color:"white"},{piece:"bishop",color:"white"},{piece:"knight",color:"white"},{piece:"rook",color:"white"}]
    ];
    let turn = "white";
    let selected = null;
    let canMove = [];
    setStyle("modern");
    
    function makeBoard() {
      let html = "";
      for (x = 0; x < boardWidth; x++) {
        html += "<tr>";
        for (y = 0; y < boardHeight; y++) {
          html += "<td id=\"c"+x+y+"\" onclick=\"input("+x+","+y+")\"></td>";
        }
        html += "</tr>";
      }
      element("board").innerHTML = html;
      updateBoard();
    }
    
    function updateBoard() {
      for (x = 0; x < boardWidth; x++) {
        for (y = 0; y < boardHeight; y++) {
          let itsClass;
          if ((x+y)%2 == 0) {
            itsClass = "tile-white";
          } else {
            itsClass = "tile-black";
          }
          if (selected != null && selected.xPos == x && selected.yPos == y) {
            itsClass += " selected";
          }
          if (board[x][y] != null) {
            itsClass += " piece-"+board[x][y].color;
            if (board[x][y].color == turn && selected == null) {
              itsClass += " selectable";
            }
          }
          element("c"+x+y).setAttribute("class",itsClass);
          if (board[x][y] == null) {
            element("c"+x+y).innerHTML = "&nbsp;";
          } else {
            element("c"+x+y).innerHTML = piece[board[x][y].piece][textRef];
          }
        }
      }
      if (selected != null) {
        let thePiece = piece[board[selected.xPos][selected.yPos].piece];
        if (thePiece.moveLikePawn) findMovesPawn(selected.xPos,selected.yPos);
        if (thePiece.rider != null) {
          for (i = 0; i < thePiece.rider.length; i++) {
            findMovesRider(selected.xPos,selected.yPos,thePiece.rider[i].xGo,thePiece.rider[i].yGo);
          }
        }
        if (thePiece.leaper != null) {
          for (i = 0; i < thePiece.leaper.length; i++) {
            findMovesLeaper(selected.xPos,selected.yPos,thePiece.leaper[i].xGo,thePiece.leaper[i].yGo);
          }
        }
        canMove.forEach(function(spot){
          let theCell = element("c"+spot.xPos+spot.yPos);
          theCell.setAttribute("class",theCell.getAttribute("class")+" can-move");
          if (board[spot.xPos][spot.yPos] != null && board[spot.xPos][spot.yPos].color != turn) {
            theCell.setAttribute("class",theCell.getAttribute("class")+" will-capture");
            if (board[spot.xPos][spot.yPos].piece == "king") {
              theCell.setAttribute("class",theCell.getAttribute("class")+" will-win");
            }
          }
        });
      } else canMove = [];
    }
    
    function findMovesLeaper(xOrigin,yOrigin,xGo,yGo) {
      if (isInBounds(xOrigin+xGo,yOrigin+yGo) && (board[xOrigin+xGo][yOrigin+yGo] == null || board[xOrigin+xGo][yOrigin+yGo].color != turn)) {
        canMove.push({xPos: xOrigin+xGo, yPos: yOrigin+yGo});
      }
    }
    
    function findMovesRider(xOrigin,yOrigin,xGo,yGo) {
      let distance = 1;
      while (isInBounds(xOrigin+xGo*distance,yOrigin+yGo*distance) && board[xOrigin+xGo*distance][yOrigin+yGo*distance] == null) {
        canMove.push({xPos: xOrigin+xGo*distance, yPos: yOrigin+yGo*distance});
        distance++;
      }
      if (isInBounds(xOrigin+xGo*distance,yOrigin+yGo*distance) && board[xOrigin+xGo*distance][yOrigin+yGo*distance].color != turn) {
        canMove.push({xPos: xOrigin+xGo*distance, yPos: yOrigin+yGo*distance});
      }
    }
    
    function findMovesPawn(xOrigin,yOrigin) {
      let dir;
      if (board[xOrigin][yOrigin].color == "white") {
        dir = -1;
      } else {
        dir = 1;
      }
      if (board[xOrigin+dir][yOrigin] == null) {
        canMove.push({xPos: xOrigin+dir, yPos: yOrigin})
        if (dir == -1 && xOrigin == 6 && board[xOrigin+dir+dir][yOrigin] == null) {
          canMove.push({xPos: xOrigin+dir+dir, yPos: yOrigin})
        }
        if (dir == 1 && xOrigin == 1 && board[xOrigin+dir+dir][yOrigin] == null) {
          canMove.push({xPos: xOrigin+dir+dir, yPos: yOrigin})
        }
      }
      if (board[xOrigin+dir][yOrigin-1] != null && board[xOrigin+dir][yOrigin-1].color != turn) {
        canMove.push({xPos: xOrigin+dir, yPos: yOrigin-1});
      }
      if (board[xOrigin+dir][yOrigin+1] != null && board[xOrigin+dir][yOrigin+1].color != turn) {
        canMove.push({xPos: xOrigin+dir, yPos: yOrigin+1});
      }
    }
    
    function isInBounds(x,y) {
      return (x >= 0 && x < boardWidth && y >= 0 && y < boardHeight);
    }
    
    function input(x,y) {
      if (selected == null && (board[x][y] != null && board[x][y].color == turn)) { //choosing new piece to move
        selected = {
          xPos: x,
          yPos: y
        };
      } else if (selected.xPos == x && selected.yPos == y) { //deselecting position
        selected = null;
      } else if (selected != null && element("c"+x+y).getAttribute("class").includes("can-move")) { //moving piece to valid spot
        board[x][y] = board[selected.xPos][selected.yPos];
        board[selected.xPos][selected.yPos] = null;
        selected = null;
        if (turn == "white") {turn = "black";} else {turn = "white";}
      }
      updateBoard();
    }
  </script>
</body>
</html>